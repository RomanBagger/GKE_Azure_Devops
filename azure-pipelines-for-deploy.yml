# use with default work
#trigger:
# branches:
#   include:
#     - main

trigger: none  #this for test, more confortable

pool:
  name: 'Default'
  demands:
    - agent.name -equals instance-20250115-185328

variables:
  GCP_SERVICE_CONNECTION: 'mygcpconnection'
  Working_Directory: '$(System.DefaultWorkingDirectory)/applications'

steps:

- script: |
    gcloud container clusters get-credentials $(CLUSTER_NAME) --zone $(ZONE) --project $(PROJECT)
  workingDirectory: $(Working_Directory)
  displayName: 'Connection to GKE'

- script: |
    helm upgrade --install ingress ingress_rules/helm_chart  
  workingDirectory: $(Working_Directory)
  displayName: 'Deploy ingress rules'

- script: |
    helm upgrade --install nginx app1/helm_chart
  workingDirectory: $(Working_Directory)
  displayName: 'Deploy first application'

- script: |
    helm upgrade --install tomcat app2/helm_chart 
  workingDirectory: $(Working_Directory)
  displayName: 'Deploy second application'
